<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Cambo Daily</title>
  <style>
    * {
      box-sizing: border-box;
    }
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background: #f5f5f5;
    }
    header {
      background: #2d3436;
      color: white;
      padding: 1rem;
      text-align: center;
    }
    nav {
      background: #dfe6e9;
      padding: 1rem;
      text-align: center;
    }
    nav button {
      padding: 0.5rem 1.2rem;
      border: none;
      border-radius: 4px;
      margin: 0 5px;
      cursor: pointer;
      background: #636e72;
      color: white;
    }
    nav button.active {
      background: #0984e3;
    }
    .container {
      max-width: 1200px;
      margin: auto;
      background: white;
      padding: 2rem;
      margin-top: 1rem;
      border-radius: 8px;
    }
    .section {
      display: none;
    }
    .section.active {
      display: block;
    }
    form input, form textarea {
      width: 100%;
      margin-bottom: 1rem;
      padding: 0.8rem;
      font-size: 1rem;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    button[type="submit"], .btn {
      background: #0984e3;
      color: white;
      padding: 0.7rem 1.5rem;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    .delete-btn {
      background: #d63031;
      color: white;
      margin-top: 1rem;
      padding: 0.5rem 1rem;
    }
    #articlesList {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 20px;
    }
    .article-preview {
      position: relative;
      width: 100%;
      max-width: 300px;
      height: 200px;
      overflow: hidden;
      border-radius: 8px;
      cursor: pointer;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      transition: transform 0.2s ease;
    }
    .article-preview:hover {
      transform: scale(1.02);
    }
    .article-preview img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .article-title {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      background: rgba(0, 0, 0, 0.5);
      color: white;
      padding: 8px 12px;
      font-size: 1rem;
      border-bottom-left-radius: 8px;
      border-bottom-right-radius: 8px;
    }
    .article-full img {
      max-width: 100%;
      margin: 1rem 0;
      border-radius: 8px;
    }
    @media screen and (max-width: 768px) {
      .article-preview {
        height: 180px;
        max-width: 100%;
      }
      nav button {
        display: block;
        width: 100%;
        margin: 0.5rem 0;
      }
    }
  </style>
</head>
<body>

<header>
  <h1>Cambo Daily</h1>
  <p>Explore articles by the site creator</p>
</header>

<nav>
  <button id="viewTab" class="active">View Articles</button>
  <button id="writeTab">Admin Write</button>
</nav>

<div class="container">
  <!-- Admin Write Section -->
  <div id="writeSection" class="section">
    <h2>Write New Article</h2>
    <form id="articleForm">
      <input type="text" id="title" placeholder="Article Title" required />
      <textarea id="content" rows="6" placeholder="Write your article..." required></textarea>
      <input type="file" id="imageUpload" accept="image/*" />
      <button type="submit">Publish</button>
    </form>
    <div id="adminArticles"></div>
  </div>

  <!-- View Articles -->
  <div id="viewSection" class="section active">
    <h2>Published Articles</h2>
    <div id="articlesList"></div>
    <div id="fullArticle"></div>
  </div>
</div>

<script>
  const writeTab = document.getElementById("writeTab");
  const viewTab = document.getElementById("viewTab");
  const writeSection = document.getElementById("writeSection");
  const viewSection = document.getElementById("viewSection");
  const form = document.getElementById("articleForm");
  const articlesList = document.getElementById("articlesList");
  const fullArticle = document.getElementById("fullArticle");
  const adminArticles = document.getElementById("adminArticles");

  let isAdmin = false;

  const adminUsername = "admin";
  const adminPassword = "123";

  viewTab.addEventListener("click", () => {
    viewTab.classList.add("active");
    writeTab.classList.remove("active");
    viewSection.classList.add("active");
    writeSection.classList.remove("active");
    
    // Update history state
    history.pushState({ section: 'view' }, 'View Articles', '#view');
    
    displayArticles();
  });

  writeTab.addEventListener("click", () => {
    if (!isAdmin) {
      const inputUser = prompt("Enter admin username:");
      const inputPass = prompt("Enter admin password:");

      if (inputUser === adminUsername && inputPass === adminPassword) {
        isAdmin = true;
        alert("Welcome, Admin!");
      } else {
        alert("Incorrect credentials.");
        return;
      }
    }

    writeTab.classList.add("active");
    viewTab.classList.remove("active");
    writeSection.classList.add("active");
    viewSection.classList.remove("active");
    
    // Update history state
    history.pushState({ section: 'write' }, 'Write Article', '#write');
    
    displayAdminArticles();
  });

  form.addEventListener("submit", function (e) {
    e.preventDefault();

    const title = document.getElementById("title").value;
    const content = document.getElementById("content").value;
    const imageInput = document.getElementById("imageUpload");
    const imageFile = imageInput.files[0];

    const reader = new FileReader();

    reader.onload = function () {
      const newArticle = {
        title,
        content,
        image: imageFile ? reader.result : null,
        date: new Date().toISOString()
      };

      let articles = JSON.parse(localStorage.getItem("articles")) || [];
      articles.unshift(newArticle);
      localStorage.setItem("articles", JSON.stringify(articles));

      form.reset();
      displayArticles();
      displayAdminArticles();
      alert("Article published successfully!");

      // Switch back to view articles after publishing
      viewTab.click();
    };

    if (imageFile) {
      reader.readAsDataURL(imageFile);
    } else {
      reader.onload();
    }
  });

  function displayArticles() {
    articlesList.innerHTML = "";
    fullArticle.innerHTML = "";
    const articles = JSON.parse(localStorage.getItem("articles")) || [];

    articles.forEach((article, index) => {
      const articleDiv = document.createElement("div");
      articleDiv.innerHTML = `
        <div class="article-preview" onclick="viewFullArticle(${index})">
          <img src="${article.image}" alt="Article Image">
          <div class="article-title">${article.title}</div>
        </div>
      `;
      articlesList.appendChild(articleDiv);
    });
  }

  function viewFullArticle(index) {
    const articles = JSON.parse(localStorage.getItem("articles")) || [];
    const article = articles[index];
    articlesList.innerHTML = "";
    fullArticle.innerHTML = `
      <div class="article-full">
        ${article.image ? `<img src="${article.image}" alt="Article Image">` : ""}
        <h2>${article.title}</h2>
        <p><strong>Published:</strong> ${formatDate(article.date)}</p>
        <p>${article.content.replace(/\n/g, "<br>")}</p>
      </div>
    `;
  }

  function displayAdminArticles() {
    adminArticles.innerHTML = "";
    const articles = JSON.parse(localStorage.getItem("articles")) || [];

    articles.forEach((article, index) => {
      const div = document.createElement("div");
      div.innerHTML = `
        <hr>
        <strong>${article.title}</strong>
        <button class="delete-btn" onclick="deleteArticle(${index})">Delete</button>
      `;
      adminArticles.appendChild(div);
    });
  }

  function deleteArticle(index) {
    if (!isAdmin) return;
    let articles = JSON.parse(localStorage.getItem("articles")) || [];
    articles.splice(index, 1);
    localStorage.setItem("articles", JSON.stringify(articles));
    displayArticles();
    displayAdminArticles();
  }

  function formatDate(dateString) {
    const date = new Date(dateString);
    const options = { hour: 'numeric', minute: 'numeric', hour12: true };
    const datePart = `${String(date.getDate()).padStart(2, '0')}/${String(date.getMonth()+1).padStart(2, '0')}/${date.getFullYear()}`;
    const timePart = date.toLocaleTimeString([], options);
    return `${datePart} ${timePart}`;
  }

  // Listen for popstate event to handle browser back/forward actions
  window.addEventListener('popstate', (event) => {
    if (event.state) {
      if (event.state.section === 'view') {
        viewTab.classList.add("active");
        writeTab.classList.remove("active");
        viewSection.classList.add("active");
        writeSection.classList.remove("active");
        displayArticles();
      } else if (event.state.section === 'write') {
        writeTab.classList.add("active");
        viewTab.classList.remove("active");
        writeSection.classList.add("active");
        viewSection.classList.remove("active");
        displayAdminArticles();
      }
    }
  });

  // Handle initial page load based on URL hash
  window.onload = function () {
    if (window.location.hash === '#write') {
      writeTab.click();
    } else {
      viewTab.click();
    }

    displayArticles();
  };
</script>

</body>
</html>
